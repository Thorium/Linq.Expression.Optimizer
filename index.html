<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8"/>
    <title>Linq.Expression.Optimizer
</title>
    <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
    <meta name="description" content="Lightweight optimizer of System.Linq.Expression expressions. Just basic boolean algebra and reductions, constant and tuple/anonymous type eliminations. For expressions that are not compiled to IL."/>
    <meta name="author" content="Tuomas Hietanen"/>

    <script src="https://code.jquery.com/jquery-1.8.0.js"></script>
    <script src="https://code.jquery.com/ui/1.8.23/jquery-ui.js"></script>
    <script src="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/js/bootstrap.min.js"></script>
    <link href="https://netdna.bootstrapcdn.com/twitter-bootstrap/2.2.1/css/bootstrap-combined.min.css" rel="stylesheet"/>

    <link type="text/css" rel="stylesheet" href="/Linq.Expression.Optimizer/content/style.css" />
    <script type="text/javascript" src="/Linq.Expression.Optimizer/content/tips.js"></script>
    <!-- HTML5 shim, for IE6-8 support of HTML5 elements -->
    <!--[if lt IE 9]>
      <script src="https://oss.maxcdn.com/html5shiv/3.7.2/html5shiv.min.js"></script>
    <![endif]-->
  </head>
  <body>
    <div class="container">
      <div class="masthead">
        <ul class="nav nav-pills pull-right">
          <li><a href="http://fsharp.org">fsharp.org</a></li>
          <li><a href="https://github.com/Thorium/Linq.Expression.Optimizer">github page</a></li>
        </ul>
        <h3 class="muted"><a href="/Linq.Expression.Optimizer/index.html">Linq.Expression.Optimizer</a></h3>
      </div>
      <hr />
      <div class="row">
        <div class="span9" id="main">
          
<h1><a name="Linq-Expression-Optimizer" class="anchor" href="#Linq-Expression-Optimizer">Linq.Expression.Optimizer</a></h1>
<p>Lightweight optimizer of System.Linq.Expression expressions.
Just basic boolean algebra and reductions, constant and tuple/anonymous type eliminations.
For side-effect free Expressions. No compilation-subjective optimizations.
This is meant to be used with expressions that are not compiled but transferred to other domain.</p>
<h2><a name="Supported-optimizations" class="anchor" href="#Supported-optimizations">Supported optimizations</a></h2>
<p>Example as a quote. There are various other cases also.</p>
<ul>
<li>Replace constants comparisons: <code>3 &lt; 4  -&gt;  true</code></li>
<li>Remove anonymous types: <code>new AnonymousObject(Item1 = x, Item2 = "").Item1  -&gt;  x</code></li>
<li>Cut not used condition: <code>if false then x else y  -&gt;  y</code></li>
<li>Remove not: <code>not(false)  -&gt;  true</code></li>
<li>Binary tree balancing: <code>a or (b or (c or (d or (e or (f or (g or h)))))) -&gt; ((a or b) or (c or d)) or ((e or f) or (g or h))</code></li>
<li>Captured closure constant ("free variable") evaluation: <code>y = 3 and (y + x)  -&gt;  (3 + x)</code></li>
<li>
Boolean algebra reductions:
<ul>
<li>gather            <code>(x or y) and (x or z)   -&gt; x or (y and z)</code></li>
<li>identity          <code>false or y  -&gt;  y</code></li>
<li>annihilate        <code>true or x  -&gt;  true</code></li>
<li>absorb            <code>x and (x or y)  -&gt;  x</code></li>
<li>idempotence       <code>y or y  -&gt;  y</code></li>
<li>complement        <code>x and not(x)  -&gt;  false</code></li>
<li>doubleNegation    <code>not(not(y))  -&gt;  y</code></li>
<li>deMorgan          <code>not(x) and not(y)  -&gt;  not(x or y)</code></li>
</ul>
</li>
</ul>
<h2><a name="Installation" class="anchor" href="#Installation">Installation</a></h2>
<div class="row">
  <div class="span1"></div>
  <div class="span6">
    <div class="well well-small" id="nuget">
      The Linq.Expression.Optimizer library can be <a href="https://nuget.org/packages/Linq.Expression.Optimizer">installed from NuGet</a>:
      <pre>PM> Install-Package Linq.Expression.Optimizer</pre>
    </div>
  </div>
  <div class="span1"></div>
</div>
<p>Currently Linq.Expression.Optimizer is using .NET Framework 4.5.</p>
<h2><a name="Example-C" class="anchor" href="#Example-C">Example (C#)</a></h2>
<p>This example demonstrates using a function defined in this sample library.</p>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
<span class="l">18: </span>
<span class="l">19: </span>
<span class="l">20: </span>
<span class="l">21: </span>
<span class="l">22: </span>
<span class="l">23: </span>
<span class="l">24: </span>
<span class="l">25: </span>
<span class="l">26: </span>
<span class="l">27: </span>
<span class="l">28: </span>
<span class="l">29: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="csharp"><span class="k">using</span> System;
<span class="k">using</span> System.Linq;

<span class="k">class</span> Program
{
    <span class="k">static</span> <span class="k">void</span> Main(<span class="k">string</span>[] args)
    {
        <span class="c">// e.g. Database IQueryable:</span>
        <span class="k">var</span> xs <span class="o">=</span> <span class="k">new</span>[] { <span class="n">1</span>, <span class="n">2</span>, <span class="n">3</span>, <span class="n">4</span>, <span class="n">5</span> }.AsQueryable();

        <span class="k">var</span> qry <span class="o">=</span>
            <span class="k">from</span> x <span class="k">in</span> xs
            <span class="k">select</span> <span class="o">!</span><span class="o">!</span><span class="o">!</span>((<span class="k">new</span> { MyUnUsedItem <span class="o">=</span> <span class="n">123</span>, 
                              MyItem <span class="o">=</span> <span class="k">new</span> Tuple&lt;<span class="k">int</span>, <span class="k">int</span>&gt;(x, <span class="n">2</span>).Item<span class="n">1</span>
                            }.MyItem) <span class="o">&gt;</span> <span class="n">3</span>) <span class="o">&amp;</span><span class="o">&amp;</span> <span class="k">true</span>;

        <span class="k">var</span> optimized <span class="o">=</span> ExpressionOptimizer.visit(qry.Expression);

        Console.WriteLine(qry.Expression);
            <span class="c">// System.Int32[].Select(x =&gt; (Not(Not(Not((</span>
            <span class="c">// new &lt;&gt;f__AnonymousType0`2(MyUnUsedItem = 123, </span>
            <span class="c">// MyItem = new Tuple`2(x, 2).Item1).MyItem &gt; 3)))) AndAlso True))</span>

        Console.WriteLine(optimized);
            <span class="c">// System.Int32[].Select(x =&gt; Not((x &gt; 3)))</span>
        Console.ReadLine();

    }
}
</code></pre></td></tr></table>
<h2><a name="Example-F" class="anchor" href="#Example-F">Example (F#)</a></h2>
<table class="pre"><tr><td class="lines"><pre class="fssnip"><span class="l"> 1: </span>
<span class="l"> 2: </span>
<span class="l"> 3: </span>
<span class="l"> 4: </span>
<span class="l"> 5: </span>
<span class="l"> 6: </span>
<span class="l"> 7: </span>
<span class="l"> 8: </span>
<span class="l"> 9: </span>
<span class="l">10: </span>
<span class="l">11: </span>
<span class="l">12: </span>
<span class="l">13: </span>
<span class="l">14: </span>
<span class="l">15: </span>
<span class="l">16: </span>
<span class="l">17: </span>
</pre></td>
<td class="snippet"><pre class="fssnip highlighted"><code lang="fsharp"><span class="prep">#if</span> <span class="i">INTERACTIVE</span>
<span class="inactive">#I</span><span class="inactive"> </span><span class="inactive">&quot;../../bin/Linq.Expression.Optimizer/&quot;</span>
<span class="inactive">#r</span><span class="inactive"> </span><span class="inactive">&quot;Linq.Expression.Optimizer.dll&quot;</span>
<span class="prep">#endif</span>

<span class="k">open</span> <span onmouseout="hideTip(event, 'fs1', 1)" onmouseover="showTip(event, 'fs1', 1)" class="i">System</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs2', 2)" onmouseover="showTip(event, 'fs2', 2)" class="i">Linq</span>

<span class="c">// e.g. Database IQueryable:</span>
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs3', 3)" onmouseover="showTip(event, 'fs3', 3)" class="i">xs</span> <span class="o">=</span> [<span class="n">1</span>;<span class="n">2</span>;<span class="n">3</span>;<span class="n">4</span>;<span class="n">5</span>]<span class="o">.</span><span class="i">AsQueryable</span>()

<span class="k">let</span> <span onmouseout="hideTip(event, 'fs4', 4)" onmouseover="showTip(event, 'fs4', 4)" class="i">qry</span> <span class="o">=</span>
    <span onmouseout="hideTip(event, 'fs5', 5)" onmouseover="showTip(event, 'fs5', 5)" class="i">query</span>{
        <span class="k">for</span> <span onmouseout="hideTip(event, 'fs6', 6)" onmouseover="showTip(event, 'fs6', 6)" class="i">x</span> <span class="k">in</span> <span onmouseout="hideTip(event, 'fs3', 7)" onmouseover="showTip(event, 'fs3', 7)" class="i">xs</span> <span class="k">do</span>
        <span onmouseout="hideTip(event, 'fs7', 8)" onmouseover="showTip(event, 'fs7', 8)" class="k">select</span> (<span onmouseout="hideTip(event, 'fs8', 9)" onmouseover="showTip(event, 'fs8', 9)" class="f">not</span>(<span onmouseout="hideTip(event, 'fs8', 10)" onmouseover="showTip(event, 'fs8', 10)" class="f">not</span>(<span onmouseout="hideTip(event, 'fs8', 11)" onmouseover="showTip(event, 'fs8', 11)" class="f">not</span>(<span onmouseout="hideTip(event, 'fs6', 12)" onmouseover="showTip(event, 'fs6', 12)" class="i">x</span><span class="o">&gt;</span><span class="n">3</span>))) <span class="o">&amp;&amp;</span> <span class="k">true</span>)
    }
    
<span class="k">let</span> <span onmouseout="hideTip(event, 'fs9', 13)" onmouseover="showTip(event, 'fs9', 13)" class="i">optimized</span> <span class="o">=</span> <span onmouseout="hideTip(event, 'fs10', 14)" onmouseover="showTip(event, 'fs10', 14)" class="t">ExpressionOptimizer</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs11', 15)" onmouseover="showTip(event, 'fs11', 15)" class="f">visit</span>(<span onmouseout="hideTip(event, 'fs4', 16)" onmouseover="showTip(event, 'fs4', 16)" class="i">qry</span><span class="o">.</span><span onmouseout="hideTip(event, 'fs12', 17)" onmouseover="showTip(event, 'fs12', 17)" class="i">Expression</span>)
</code></pre></td>
</tr>
</table>
<p>For more motivation why to use this, see: <a href="tutorial.html">Tutorial</a></p>
<h2><a name="Samples-amp-documentation" class="anchor" href="#Samples-amp-documentation">Samples &amp; documentation</a></h2>
<p>The library comes with comprehensible documentation.
It can include tutorials automatically generated from <code>*.fsx</code> files in docs/content/.
The API reference is automatically generated from Markdown comments in the library implementation.</p>
<ul>
<li><p><a href="tutorial.html">Tutorial</a> contains a further explanation of this sample library.</p></li>
<li>
<p><a href="reference/index.html">API Reference</a> contains automatically generated documentation for all types, modules
and functions in the library. This includes additional brief samples on using most of the
functions.</p>
</li>
</ul>
<h2><a name="Testimonials" class="anchor" href="#Testimonials">Testimonials</a></h2>
<p>This component is in a large scale enterprise application for simplifying and streamlining
key financial processes. There is a huge data processing-pipeline with thousands of
different SQL-clauses (some also very complex) against separate Oracle server cluster.
The pipeline used pure EntityFramework and was converted to use LinqKit with Linq.Expression.Optimizer.
The process was performance tested multiple times, and the execution time was dropped
from 15h 30min to 14h 30min, mainly due to delivering less CPU usage to Oracle servers.</p>
<h2><a name="Contributing-and-copyright" class="anchor" href="#Contributing-and-copyright">Contributing and copyright</a></h2>
<p>The project is hosted on <a href="https://github.com/thorium/Linq.Expression.Optimizer">GitHub</a> where you can <a href="https://github.com/thorium/Linq.Expression.Optimizer/issues">report issues</a>, fork
the project and submit pull requests. If you're adding a new public API, please also
consider adding <a href="https://github.com/thorium/Linq.Expression.Optimizer/tree/master/docs/content">samples</a> that can be turned into a documentation. You might
also want to read the <a href="https://github.com/thorium/Linq.Expression.Optimizer/blob/master/README.md">library design notes</a> to understand how it works.</p>
<p>The library is available under Public Domain license, which allows modification and
redistribution for both commercial and non-commercial purposes. For more information see the
<a href="https://github.com/thorium/Linq.Expression.Optimizer/blob/master/LICENSE.txt">License file</a> in the GitHub repository.</p>

<div class="tip" id="fs1">namespace System</div>
<div class="tip" id="fs2">namespace System.Linq</div>
<div class="tip" id="fs3">val xs : System.Linq.IQueryable&lt;int&gt;<br /><br />Full name: Index.xs</div>
<div class="tip" id="fs4">val qry : System.Linq.IQueryable&lt;bool&gt;<br /><br />Full name: Index.qry</div>
<div class="tip" id="fs5">val query : Linq.QueryBuilder<br /><br />Full name: Microsoft.FSharp.Core.ExtraTopLevelOperators.query</div>
<div class="tip" id="fs6">val x : int</div>
<div class="tip" id="fs7">custom operation: select (&#39;Result)<br /><br />Calls Linq.QueryBuilder.Select </div>
<div class="tip" id="fs8">val not : value:bool -&gt; bool<br /><br />Full name: Microsoft.FSharp.Core.Operators.not</div>
<div class="tip" id="fs9">val optimized : System.Linq.Expressions.Expression<br /><br />Full name: Index.optimized</div>
<div class="tip" id="fs10">module ExpressionOptimizer</div>
<div class="tip" id="fs11">val visit : exp:System.Linq.Expressions.Expression -&gt; System.Linq.Expressions.Expression<br /><br />Full name: ExpressionOptimizer.visit</div>
<div class="tip" id="fs12">property System.Linq.IQueryable.Expression: System.Linq.Expressions.Expression</div>

        </div>
        <div class="span3">
          <img src="/Linq.Expression.Optimizer/img/logo.png" alt="F# Project" style="width:150px;margin:10px" />  
          <ul class="nav nav-list" id="menu" style="margin-top: 20px;">
            <li class="nav-header">Linq.Expression.Optimizer</li>
            <li><a href="/Linq.Expression.Optimizer/index.html">Home page</a></li>
            <li class="divider"></li>
            <li><a href="http://nuget.org/packages/Linq.Expression.Optimizer">Get Library via NuGet</a></li>
            <li><a href="https://github.com/Thorium/Linq.Expression.Optimizer">Source Code on GitHub</a></li>
            <li><a href="/Linq.Expression.Optimizer/license.html">License</a></li>
            <li><a href="/Linq.Expression.Optimizer/release-notes.html">Release Notes</a></li>
            
            <li class="nav-header">Getting started</li>
            <li><a href="/Linq.Expression.Optimizer/tutorial.html">Sample tutorial</a></li>

            <li class="nav-header">Documentation</li>
            <li><a href="/Linq.Expression.Optimizer/reference/index.html">API Reference</a></li>
          </ul>
        </div>
      </div>
    </div>
    <a href="https://github.com/Thorium/Linq.Expression.Optimizer"><img style="position: absolute; top: 0; right: 0; border: 0;" src="https://s3.amazonaws.com/github/ribbons/forkme_right_gray_6d6d6d.png" alt="Fork me on GitHub"/></a>
  </body>
  </html>
